<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://unpkg.com/98.css">
<style>
html, body { height: 100%; margin:0; background:#008080; font-family:'MS Sans Serif',sans-serif;}
.window { display:flex; flex-direction:column; height:100%; border:2px solid #fff; }
.toolbar { display:flex; gap:4px; padding:2px; align-items:center; }
.toolbar input[type="text"] { flex:1; }
iframe { flex:1; border:none; width:100%; }
button { display:flex; align-items:center; justify-content:center; width:24px; height:24px; padding:0; border:2px outset #fff; background:#c0c0c0; }
button img { width:16px; height:16px; }
</style>
</head>
<body>
<div class="window">
  <div class="toolbar">
    <button id="back" title="Back" disabled>
      <img src="https://img.icons8.com/ios/16/000000/back--v1.png" alt="Back">
    </button>
    <button id="forward" title="Forward" disabled>
      <img src="https://img.icons8.com/ios/16/000000/forward--v1.png" alt="Forward">
    </button>
    <button id="refresh" title="Refresh">
      <img src="https://img.icons8.com/ios/16/000000/refresh.png" alt="Refresh">
    </button>
    <form id="search" style="flex:1; display:flex; margin:0;">
      <input id="url" type="text" class="search-input search" placeholder="Search the web or enter URL" style="flex:1">
      <button id="go" title="Go" type="submit">
        <img src="https://img.icons8.com/ios/16/000000/chevron-right.png" alt="Go">
      </button>
    </form>
  </div>
  <iframe id="iframe" src="/newtab.html"></iframe>
</div>

<script>
const iframe = document.getElementById("iframe");
const urlInput = document.getElementById("url");
const backBtn = document.getElementById("back");
const forwardBtn = document.getElementById("forward");
const refreshBtn = document.getElementById("refresh");

const historyStack = ["/newtab.html"];
let currentIndex = 0;

function updateButtons() {
  backBtn.disabled = currentIndex <= 0;
  forwardBtn.disabled = currentIndex >= historyStack.length - 1;
}

function formatInput(input) {
  if (!input || input.trim() === "") return "/newtab.html";

  input = input.trim();

  const urlPattern = /\./; 
  try {
    const testUrl = new URL(input);
    return "/scram/" + testUrl.href;
  } catch {
    if (urlPattern.test(input)) {
      return "/scram/https://" + input;
    }
  }

  const query = encodeURIComponent(input);
  return "/scram/https://search.brave.com/search?q=" + query;
}

function navigate(input) {
  const target = formatInput(input);
  iframe.src = target;

  if (currentIndex < historyStack.length - 1) historyStack.splice(currentIndex + 1);
  historyStack.push(input || "");
  currentIndex++;
  updateButtons();

  urlInput.value = input || "";
}

document.getElementById("search").addEventListener("submit", e => {
  e.preventDefault();
  navigate(urlInput.value);
});

refreshBtn.addEventListener("click", () => {
  iframe.src = iframe.src;
});

backBtn.addEventListener("click", () => {
  if (currentIndex > 0) {
    currentIndex--;
    const histInput = historyStack[currentIndex];
    iframe.src = formatInput(histInput);
    urlInput.value = histInput || "";
    updateButtons();
  }
});

forwardBtn.addEventListener("click", () => {
  if (currentIndex < historyStack.length - 1) {
    currentIndex++;
    const histInput = historyStack[currentIndex];
    iframe.src = formatInput(histInput);
    urlInput.value = histInput || "";
    updateButtons();
  }
});

urlInput.value = "";
updateButtons();
</script>
</body>
</html>
